# 딥러닝 기반 흉부 X-Ray 폐질환 분류 (Capstone design 2020-2)
* 소프트웨어융합학과 이인석

## 1. 과제 개요

### 가. 과제 선정 배경 및 필요성
결핵 발생과 사망률을 줄이기 위해서는 결핵 환자를 조기에 발견하는 것이 무엇보다 중요하다. 하지만1차 검진 수단인 흉부 x선 영상으로 결핵을 판독하는 방사선과 전문의는 전체 의사의 5%도 안되고, 전체 병의원의 70% 이상이 방사선과 전문의 없이 운영되고 있다. 병의원의 의뢰를 받아 영상판독센터가 영상을 대신 분석해주고 있지만, 전국에 몇곳이 안되어서 이메일로 판독을 의뢰하면 일러야 하루, 늦으면 1주일이 소요된다. 객담이나 혈액 분석을 통한 2차 검진으로 결핵을 확진하기까지는 빠르면 1주일 길게는 8주까지도 소요된다. 폐 영상을 찍은 후 곧바로 결과가 나오지 않는 현재의 진단 기술로는 2차감염을 차단할 골든타임을 놓치기 쉽다. 따라서 X-Ray를 통해 병명을 조기 진단하는 연구가 필요하다.

### 나. 과제 주요내용
- 폐질환 데이터 수집
- 데이터 전처리 및 증강
- 5-Layer CNN, ResNet-18 모델
- 모델의 성능 측정 및 평가

## 2. 과제의 목표

### 가. 최종결과물의 목표 (정량적/정성적 목표 설정)

1) 폐질환 질병명을 분류하는 딥러닝 모델의 성능의 정확도를 70% 이상을 목표로 한다.

2) Data Augmentation 추가하여 성능을 비교한다.

3) 학습에 사용한 각 모델별 성능을 비교한다.

### 나. 최종결과물의 세부내용 및 구성


1) 데이터 수집 및 전처리

2) Data Augmentation

3) CNN Architecture (5-layer CNN, ResNet)

4) 모델 성능 평가 지표

5) 모델별 성능 비교


## 3. 기대효과 및 활용방안

결핵 여부에 대한 최종 판단은 객담이나 혈액 분석을 거쳐 2명 이상의 의사가 확진을 내려야만 가능하다. AI가 의사를 완전히 대체하지는 못하겠지만, 2차 검진이 필요한 대상자를 추려내 주는 역할을 하면서 하루 수백장의 흉부 영상을 살펴봐야 하는 의사의 작업 피로도를 덜어줄 뿐더러 하루에 수십만명의 코로나 환자가 속출하는 상황에서 보조적인 개념으로는 충분한 가치가 있다. 이러한 모델을 활용한 병원 측에서는 결핵, 폐렴, 코로나19 환자를 조기에 발견하여 치료할 수 있을 것을 기대해 볼 수 있다.

## 4. 수행방법

### 가. 과제수행을 위한 도구적 방법

Python, Colab, Pytorch

### 나. 과제수행 계획

이미지 데이터 수집 → 훈련데이터와 테스트데이터 분할 → CNN 모델로 학습 → 모델 성능 측정 → 성능 향상을 위해 Data Augmentation 기법 적용 → 모델 학습 → 모델 성능 측정 → 모델별 성능 비교

## Schedule
| Contents | March | April |  May  | June  |   Progress   |
|----------|-------|-------|-------|-------|--------------|
|  데이터 수집  |   O   |       |       |       |     Link1    |
|  관련 기법 학습  |   O   |   O    |       |       |     Link2    |
|  모델 구축 및 수정  |       |      |   O   |   O    |     Link3    |
|  성능 비교  |       |       |      |   O    |     Link4    |
|  보고서 작성  |       |       |       |   O   |     Link5    |


## Results
### 모델별 F1-Score
|     Model   | No Aug | Aug    |
|-------------|--------|--------|
|    CNN      |0.7548| None |
|    ResNet   |0.3537|0.7898|


## Conclusion

* 활용한 데이터셋을 살펴보면 폐렴 데이터에 비해 코로나19데이터와 폐결핵 데이터는 매우 적고 데이터가 불균형하다. 하지만 실제로 4가지 병명 중에는 폐렴이 가장 흔하고 모집단도 크게 다르지 않다고 생각한다. 따라서 추가적인 데이터 없이 불균형한 데이터 셋에 맞게 최선의 성능을 내는 모델을 학습하고 평가하고자 했다. 

* 데이터 증강을 적용하지 않은 5계층 CNN모델의 정확도가 73% 나온 반면 ResNet18 모델의 정확도가 52%가 나왔다. 또한 Flip, rotation, crop등의 데이터 증강 기법을 적용한 데이터셋을 사용한 ResNet18 모델은 80%의 정확도가 나왔다. 데이터 증강 기법이 성능 향상에 크게 기여를 했음을 알 수 있다. 또한 층이 깊고 복잡한 모델일수록 꼭 성능이 좋은 것은 아니라는 것을 직접 확인할 수 있었다. 

* 연구 과제에서 ResNet으로 학습한 모델은 실제 폐 질환 데이터 셋이기 때문에 영상 의학에서 활용이 가능하지만 아직은 성능 향상을 위해 최적화가 필요해 보인다. 이번에 총 7135장의 이미지 데이터로 3-D 5계층CNN 과 ResNet18 모델을 학습시키고 성능 평가를 진행하는 연구를 진행했다면, 다음은 더 큰 데이터셋을 확보하고 큰 네트워크를 가진 모델을 사용해보고 좀 더 다양한 하이퍼파라미터 조정을 통해 최적화를 하는 연구를 진행해보고자 한다. 데이터셋의 크기에 따라 어떤 크기의 딥러닝 네트워크를 학습시킬지 어떤 최적화 기법을 사용할지 인사이트를 길러야 겠다는 확신이 든 이번 연구 과제였다. 

## Reports
* Upload or link (e.g. Google Drive files with share setting)
* Midterm: [Report](Reports/Midterm.pdf)
* Final: [Report](Reports/Final.pdf), [Demo video](Reports/Demo.mp4)
